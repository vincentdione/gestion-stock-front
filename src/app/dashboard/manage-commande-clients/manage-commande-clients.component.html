<div class="modern-container">
  <!-- En-tête modernisé -->
  <div class="modern-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon class="title-icon">shopping_cart</mat-icon>
          Gestion des Commandes {{origin}}
        </h1>
        <p class="page-subtitle">Consultez et gérez toutes vos commandes</p>
      </div>
      <button mat-flat-button color="primary" class="add-button" [routerLink]="'/workspace/dashboard/' + addCommande">
        <mat-icon>add</mat-icon>
        Ajouter une commande
      </button>
    </div>

    <!-- Cartes de statistiques -->
    <div class="stats-cards" *ngIf="(origin === 'client' ? comClients?.length : comFournisseurs?.length)">
      <mat-card class="stat-card">
        <div class="stat-content">
          <mat-icon class="stat-icon">inventory_2</mat-icon>
          <div class="stat-text">
            <span class="stat-value">{{origin === 'client' ? comClients?.length : comFournisseurs?.length}}</span>
            <span class="stat-label">Commandes totales</span>
          </div>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <div class="stat-content">
          <mat-icon class="stat-icon">inventory_2</mat-icon>
          <div class="stat-text">
            <span class="stat-value">{{getTotalCount()}}</span>
            <span class="stat-label">Commandes totales</span>
          </div>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <div class="stat-content">
          <mat-icon class="stat-icon" [style.color]="'#ff9800'">pending</mat-icon>
          <div class="stat-text">
            <span class="stat-value">{{getEnPreparationCount()}}</span>
            <span class="stat-label">En préparation</span>
          </div>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <div class="stat-content">
          <mat-icon class="stat-icon" [style.color]="'#4caf50'">check_circle</mat-icon>
          <div class="stat-text">
            <span class="stat-value">{{getValideesCount()}}</span>
            <span class="stat-label">Validées</span>
          </div>
        </div>
      </mat-card>

      <!-- Optionnel : Ajoutez aussi une carte pour les commandes livrées -->
      <mat-card class="stat-card">
        <div class="stat-content">
          <mat-icon class="stat-icon" [style.color]="'#2196f3'">local_shipping</mat-icon>
          <div class="stat-text">
            <span class="stat-value">{{getLivreesCount()}}</span>
            <span class="stat-label">Livrées</span>
          </div>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- Filtres modernisés -->
  <mat-card class="modern-filter-card">
    <div class="filter-header">
      <mat-icon>filter_list</mat-icon>
      <h3>Filtres de recherche</h3>
    </div>

    <form [formGroup]="filterForm" class="modern-filter-form">
      <div class="filter-grid">
        <mat-form-field appearance="outline" class="modern-form-field">
          <mat-label>Nom ou Prénom</mat-label>
          <input
            type="text"
            matInput
            formControlName="nom"
            [matAutocomplete]="autoNomPrenom"
            placeholder="Rechercher par nom"
          />
          <mat-icon matSuffix>person_search</mat-icon>
          <mat-autocomplete #autoNomPrenom="matAutocomplete">
            <mat-option *ngFor="let u of dataClients" [value]="u.nom">
              <div class="client-option">
                <mat-icon>person</mat-icon>
                <span>{{ u.nom }} {{ u.prenom }}</span>
              </div>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field appearance="outline" class="modern-form-field">
          <mat-label>Email</mat-label>
          <input
            type="text"
            matInput
            formControlName="email"
            [matAutocomplete]="autoEmail"
            placeholder="Rechercher par email"
          />
          <mat-icon matSuffix>email</mat-icon>
          <mat-autocomplete #autoEmail="matAutocomplete">
            <mat-option *ngFor="let u of dataClients" [value]="u.email">
              <div class="client-option">
                <mat-icon>email</mat-icon>
                <span>{{ u.email }}</span>
              </div>
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field appearance="outline" class="modern-form-field">
          <mat-label>Code commande</mat-label>
          <input
            type="text"
            matInput
            formControlName="codeCommande"
            placeholder="Rechercher par code"
          />
          <mat-icon matSuffix>qr_code</mat-icon>
        </mat-form-field>
      </div>

      <div class="filter-actions">
        <button mat-stroked-button type="button" (click)="resetFilters()" class="reset-btn">
          <mat-icon>restart_alt</mat-icon>
          Réinitialiser
        </button>
        <button mat-flat-button color="primary" (click)="onSearch()" class="search-btn">
          <mat-icon>search</mat-icon>
          Rechercher
        </button>
      </div>
    </form>
  </mat-card>

  <!-- Liste des commandes modernisée -->
  <mat-card class="modern-list-card">
    <div class="list-header">
      <h3>Liste des commandes</h3>
      <div class="list-actions">
        <button mat-icon-button matTooltip="Actualiser" (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <!-- Section pour les commandes clients -->
    <div *ngIf="origin === 'client'">
      <div *ngIf="comClients?.length === 0" class="empty-state">
        <mat-icon class="empty-icon">inbox</mat-icon>
        <h4>Aucune commande trouvée</h4>
        <p>Commencez par ajouter une nouvelle commande</p>
        <button mat-flat-button color="primary" [routerLink]="'/workspace/dashboard/' + addCommande">
          <mat-icon>add</mat-icon>
          Ajouter une commande
        </button>
      </div>

      <div *ngIf="comClients && comClients.length > 0" class="commandes-list">
        <mat-accordion>
          <mat-expansion-panel *ngFor="let element of comClients"
                              [class.en-preparation]="element.etat === 'EN_PREPARATION'"
                              [class.validee]="element.etat === 'VALIDEE'"
                              [class.livree]="element.etat === 'LIVREE'">
            <mat-expansion-panel-header class="modern-panel-header">
              <mat-panel-title class="panel-title">
                <div class="commande-info">
                  <mat-icon class="commande-icon">receipt_long</mat-icon>
                  <div class="commande-details">
                    <span class="commande-code">{{element.code}}</span>
                    <span class="commande-date">{{element.dateCommande | date: 'dd/MM/yyyy' }}</span>
                  </div>
                </div>
              </mat-panel-title>

              <mat-panel-description class="panel-description">
                <div class="client-info">
                  <mat-icon>person</mat-icon>
                  <span>{{element.clientDto?.prenom}} {{element.clientDto?.nom}}</span>
                </div>
              </mat-panel-description>

              <mat-panel-description class="panel-description">
                <mat-chip [color]="getChipColor(element.etat)" selected class="etat-chip">
                  {{element.etat}}
                </mat-chip>
              </mat-panel-description>

              <mat-panel-description class="panel-description actions">
                <button mat-icon-button color="warn" matTooltip="Supprimer" (click)="handleDelete(element); $event.stopPropagation()">
                  <mat-icon>delete_outline</mat-icon>
                </button>
                <button mat-icon-button color="primary" matTooltip="Voir détails" (click)="handleView(element); $event.stopPropagation()">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button color="accent" matTooltip="Télécharger PDF" (click)="$event.stopPropagation()">
                  <mat-icon>download</mat-icon>
                </button>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="expansion-content">
              <app-details-lignes-commandes [idCommande]="element?.id" [origin]="origin"></app-details-lignes-commandes>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>

    <!-- Section pour les commandes fournisseurs -->
    <div *ngIf="origin === 'fournisseur'">
      <div *ngIf="comFournisseurs?.length === 0" class="empty-state">
        <mat-icon class="empty-icon">inbox</mat-icon>
        <h4>Aucune commande trouvée</h4>
        <p>Commencez par ajouter une nouvelle commande</p>
        <button mat-flat-button color="primary" [routerLink]="'/workspace/dashboard/' + addCommande">
          <mat-icon>add</mat-icon>
          Ajouter une commande
        </button>
      </div>

      <div *ngIf="comFournisseurs && comFournisseurs.length > 0" class="commandes-list">
        <mat-accordion>
          <mat-expansion-panel *ngFor="let element of comFournisseurs"
                              [class.en-preparation]="element.etatCommande === 'EN_PREPARATION'"
                              [class.validee]="element.etatCommande === 'VALIDEE'"
                              [class.livree]="element.etatCommande === 'LIVREE'">
            <mat-expansion-panel-header class="modern-panel-header">
              <mat-panel-title class="panel-title">
                <div class="commande-info">
                  <mat-icon class="commande-icon">receipt_long</mat-icon>
                  <div class="commande-details">
                    <span class="commande-code">{{element.code}}</span>
                    <span class="commande-date">{{element.dateCommande | date: 'dd/MM/yyyy' }}</span>
                  </div>
                </div>
              </mat-panel-title>

              <mat-panel-description class="panel-description">
                <div class="client-info">
                  <mat-icon>person</mat-icon>
                  <span>{{element.fournisseurDto?.prenom}} {{element.fournisseurDto?.nom}}</span>
                </div>
              </mat-panel-description>

              <mat-panel-description class="panel-description">
                <mat-chip [color]="getChipColor(element?.etatCommande)" selected class="etat-chip">
                  {{element.etatCommande}}
                </mat-chip>
              </mat-panel-description>

              <mat-panel-description class="panel-description actions">
                <button mat-icon-button color="warn" matTooltip="Supprimer" (click)="handleDelete(element); $event.stopPropagation()">
                  <mat-icon>delete_outline</mat-icon>
                </button>
                <button mat-icon-button color="primary" matTooltip="Voir détails" (click)="handleView(element); $event.stopPropagation()">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button color="accent" matTooltip="Télécharger PDF" (click)="$event.stopPropagation()">
                  <mat-icon>download</mat-icon>
                </button>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="expansion-content">
              <app-details-lignes-commandes [idCommande]="element?.id" [origin]="origin"></app-details-lignes-commandes>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </mat-card>
</div>