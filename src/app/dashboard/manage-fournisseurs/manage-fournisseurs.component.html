<div class="modern-supplier-container">
  <!-- En-tête modernisée -->
  <div class="modern-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="title-icon">business</mat-icon>
        <div>
          <h1 class="page-title">Gestion des fournisseurs</h1>
          <p class="page-subtitle">Gérez votre liste de fournisseurs</p>
        </div>
      </div>
      <button mat-flat-button color="primary" class="add-btn" (click)="handleAdd()">
        <mat-icon>person_add</mat-icon>
        Ajouter un fournisseur
      </button>
    </div>
  </div>

  <!-- Section de recherche -->
  <mat-card class="search-card">
    <div class="search-content">
      <mat-icon class="search-icon">search</mat-icon>
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Rechercher un fournisseur...</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Nom, email, téléphone, ville..." #filterInput>
        <button mat-icon-button matSuffix *ngIf="dataSource?.filter" (click)="clearFilter(filterInput)">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </mat-card>

  <!-- Cartes de statistiques -->
  <div class="stats-cards" *ngIf="dataSource?.data?.length > 0">
    <mat-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon">groups</mat-icon>
        <div class="stat-text">
          <span class="stat-value">{{dataSource?.data?.length || 0}}</span>
          <span class="stat-label">Fournisseurs</span>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon">location_city</mat-icon>
        <div class="stat-text">
          <span class="stat-value">{{getUniqueCities()}}</span>
          <span class="stat-label">Villes</span>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon">public</mat-icon>
        <div class="stat-text">
          <span class="stat-value">{{getUniqueCountries()}}</span>
          <span class="stat-label">Pays</span>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Tableau modernisé -->
  <mat-card class="table-card">
    <div class="table-header">
      <div class="header-left">
        <mat-icon>list_alt</mat-icon>
        <h3>Liste des fournisseurs</h3>
        <span class="count-badge">{{dataSource?.data?.length || 0}}</span>
      </div>
      <div class="header-right">
        <button mat-icon-button matTooltip="Actualiser" (click)="tableData()">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <!-- État vide -->
    <div *ngIf="!dataSource?.data?.length" class="empty-state">
      <mat-icon class="empty-icon">business</mat-icon>
      <h4>Aucun fournisseur trouvé</h4>
      <p>Commencez par ajouter votre premier fournisseur</p>
      <button mat-flat-button color="primary" (click)="handleAdd()">
        <mat-icon>add</mat-icon>
        Ajouter un fournisseur
      </button>
    </div>

    <!-- Table responsive -->
    <div *ngIf="dataSource?.data?.length > 0" class="table-container">
      <div class="responsive-table">
        <!-- Version desktop -->
        <div class="desktop-view">
          <table mat-table [dataSource]="dataSource" class="modern-table">

            <!-- Nom Column -->
            <ng-container matColumnDef="nom">
              <th mat-header-cell *matHeaderCellDef>Nom</th>
              <td mat-cell *matCellDef="let element">{{element.nom}}</td>
            </ng-container>

            <!-- Prénom Column -->
            <ng-container matColumnDef="prenom">
              <th mat-header-cell *matHeaderCellDef>Prénom</th>
              <td mat-cell *matCellDef="let element">{{element.prenom}}</td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let element">
                <a [href]="'mailto:' + element.email" class="email-link">{{element.email}}</a>
              </td>
            </ng-container>

            <!-- Téléphone Column -->
            <ng-container matColumnDef="telephone">
              <th mat-header-cell *matHeaderCellDef>Téléphone</th>
              <td mat-cell *matCellDef="let element">
                <a [href]="'tel:' + element.numTel" class="phone-link">{{element.numTel}}</a>
              </td>
            </ng-container>

            <!-- Adresse Column -->
            <ng-container matColumnDef="adresse">
              <th mat-header-cell *matHeaderCellDef>Adresse</th>
              <td mat-cell *matCellDef="let element">{{element.adresseDto?.adresse1}}</td>
            </ng-container>

            <!-- Ville Column -->
            <ng-container matColumnDef="ville">
              <th mat-header-cell *matHeaderCellDef>Ville</th>
              <td mat-cell *matCellDef="let element">
                <span class="city-badge">{{element.adresseDto?.ville}}</span>
              </td>
            </ng-container>

            <!-- Code Postal Column -->
            <ng-container matColumnDef="codepostal">
              <th mat-header-cell *matHeaderCellDef>Code Postal</th>
              <td mat-cell *matCellDef="let element">{{element.adresseDto?.codePostal}}</td>
            </ng-container>

            <!-- Pays Column -->
            <ng-container matColumnDef="pays">
              <th mat-header-cell *matHeaderCellDef>Pays</th>
              <td mat-cell *matCellDef="let element">
                <span class="country-flag">{{getCountryFlag(element.adresseDto?.pays)}}</span>
                {{element.adresseDto?.pays}}
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let element">
                <div class="actions-container">
                  <button mat-icon-button color="primary" matTooltip="Modifier"
                          (click)="handleEdit(element)" class="action-btn edit-btn">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" matTooltip="Supprimer"
                          (click)="handleDelete(element)" class="action-btn delete-btn">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- Header row -->
            <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
            <!-- Data rows -->
            <tr mat-row *matRowDef="let row; columns: displayColumns"></tr>
          </table>
        </div>

        <!-- Version mobile (cartes) -->
        <div class="mobile-view">
          <div class="supplier-cards">
            <mat-card *ngFor="let supplier of dataSource.filteredData" class="supplier-card">
              <mat-card-header>
                <div class="supplier-name">
                  <mat-icon class="supplier-icon">person</mat-icon>
                  <div>
                    <mat-card-title>{{supplier.prenom}} {{supplier.nom}}</mat-card-title>
                    <mat-card-subtitle>{{supplier.email}}</mat-card-subtitle>
                  </div>
                </div>
              </mat-card-header>

              <mat-card-content>
                <div class="supplier-details">
                  <div class="detail-item">
                    <mat-icon>phone</mat-icon>
                    <span>{{supplier.numTel}}</span>
                  </div>
                  <div class="detail-item">
                    <mat-icon>location_on</mat-icon>
                    <span>{{supplier.adresseDto?.adresse1}}</span>
                  </div>
                  <div class="detail-item">
                    <mat-icon>location_city</mat-icon>
                    <span>{{supplier.adresseDto?.ville}}, {{supplier.adresseDto?.codePostal}}</span>
                  </div>
                  <div class="detail-item">
                    <mat-icon>public</mat-icon>
                    <span>{{supplier.adresseDto?.pays}}</span>
                  </div>
                </div>
              </mat-card-content>

              <mat-card-actions class="card-actions">
                <button mat-button color="primary" (click)="handleEdit(supplier)">
                  <mat-icon>edit</mat-icon>
                  Modifier
                </button>
                <button mat-button color="warn" (click)="handleDelete(supplier)">
                  <mat-icon>delete</mat-icon>
                  Supprimer
                </button>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>
      </div>
    </div>
  </mat-card>
</div>