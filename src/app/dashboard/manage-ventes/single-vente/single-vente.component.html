<div class="single-vente-container">
  <!-- Header avec infos de la vente -->
  <div class="header-section">
    <div class="header-content">
      <div class="vente-info-card">
        <div class="vente-header">
          <div class="vente-title">
            <mat-icon class="title-icon">receipt_long</mat-icon>
            <div class="title-content">
              <h1 class="page-title">Détails de la Vente</h1>
              <div class="vente-code-badge">
                <mat-icon class="badge-icon">tag</mat-icon>
                <span class="code-text">{{vente.code || 'Vente #' + vente.id}}</span>
              </div>
            </div>
          </div>

          <div class="vente-meta">
            <div class="meta-item">
              <mat-icon class="meta-icon">calendar_today</mat-icon>
              <div class="meta-content">
                <span class="meta-label">Date</span>
                <span class="meta-value">{{vente.dateVente | date: 'dd/MM/yyyy HH:mm'}}</span>
              </div>
            </div>
            <div class="meta-item">
              <mat-icon class="meta-icon">payments</mat-icon>
              <div class="meta-content">
                <span class="meta-label">Mode paiement</span>
                <span class="meta-value">{{vente.modePayement?.code || 'Non spécifié'}}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="vente-actions">
          <button mat-flat-button color="primary" class="action-button" (click)="handleFacture()">
            <mat-icon>download</mat-icon>
            Télécharger la facture
          </button>
          <button mat-stroked-button color="primary" class="action-button" routerLink="/workspace/dashboard/ventes">
            <mat-icon>arrow_back</mat-icon>
            Retour aux ventes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Section récapitulative -->
  <div class="summary-section">
    <mat-card class="summary-card">
      <div class="card-header">
        <h2><mat-icon>summarize</mat-icon> Récapitulatif</h2>
      </div>

      <div class="summary-content">
        <div class="summary-stats">
          <div class="stat-item">
            <div class="stat-icon-container">
              <mat-icon class="stat-icon">shopping_basket</mat-icon>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{dataSource?.data?.length || 0}}</span>
              <span class="stat-label">Articles</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon-container">
              <mat-icon class="stat-icon">monetization_on</mat-icon>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{total | currency:'F':'symbol':'1.0-0'}}</span>
              <span class="stat-label">Total vente</span>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon-container">
              <mat-icon class="stat-icon">trending_up</mat-icon>
            </div>
            <div class="stat-info">
              <span class="stat-value">100%</span>
              <span class="stat-label">Complétée</span>
            </div>
          </div>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Section des articles -->
  <div class="articles-section">
    <mat-card class="articles-card">
      <div class="card-header">
        <div class="header-content">
          <h2><mat-icon>list_alt</mat-icon> Articles vendus</h2>
          <span class="articles-count">{{dataSource?.data?.length || 0}} article(s)</span>
        </div>
      </div>

      <div class="table-container" *ngIf="dataSource?.data?.length > 0; else noArticles">
        <table mat-table [dataSource]="dataSource" class="articles-table">
          <!-- Colonne Article -->
          <ng-container matColumnDef="article">
            <th mat-header-cell *matHeaderCellDef class="table-header">
              <div class="header-content">
                <mat-icon>inventory_2</mat-icon>
                <span>Article</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="table-cell article-cell">
              <div class="article-info">
                <mat-icon class="article-icon">category</mat-icon>
                <div class="article-details">
                  <span class="article-name">{{element.article?.nom}}</span>
                  <span class="article-code">{{element.article?.codeArticle}}</span>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Colonne Unité -->
          <ng-container matColumnDef="unite">
            <th mat-header-cell *matHeaderCellDef class="table-header">
              <div class="header-content">
                <mat-icon>straighten</mat-icon>
                <span>Unité</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="table-cell">
              <span class="unite-badge">{{element.unite || 'unité'}}</span>
            </td>
          </ng-container>

          <!-- Colonne Quantité -->
          <ng-container matColumnDef="quantite">
            <th mat-header-cell *matHeaderCellDef class="table-header">
              <div class="header-content">
                <mat-icon>numbers</mat-icon>
                <span>Quantité</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="table-cell">
              <div class="quantite-cell">
                <span class="quantite-value">{{element.quantite}}</span>
              </div>
            </td>
          </ng-container>

          <!-- Colonne Prix Unitaire -->
          <ng-container matColumnDef="prixUnitaire">
            <th mat-header-cell *matHeaderCellDef class="table-header">
              <div class="header-content">
                <mat-icon>price_check</mat-icon>
                <span>Prix unitaire</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="table-cell">
              {{element.prixUnitaire | currency:'F':'symbol':'1.0-0'}}
            </td>
          </ng-container>

          <!-- Colonne Total -->
          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef class="table-header">
              <div class="header-content">
                <mat-icon>calculate</mat-icon>
                <span>Total</span>
              </div>
            </th>
            <td mat-cell *matCellDef="let element" class="table-cell total-cell">
              {{(element.quantite * element.prixUnitaire) | currency:'F':'symbol':'1.0-0'}}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['article', 'unite', 'quantite', 'prixUnitaire', 'total']"
              class="table-header-row"></tr>
          <tr mat-row *matRowDef="let row; columns: ['article', 'unite', 'quantite', 'prixUnitaire', 'total']"
              class="table-row"></tr>
        </table>
      </div>

      <ng-template #noArticles>
        <div class="empty-state">
          <mat-icon class="empty-icon">inventory</mat-icon>
          <h3>Aucun article trouvé</h3>
          <p>Cette vente ne contient aucun article</p>
        </div>
      </ng-template>
    </mat-card>
  </div>

  <!-- Section total -->
  <div class="total-section">
    <mat-card class="total-card">
      <div class="total-content">
        <div class="total-info">
          <mat-icon class="total-icon">summarize</mat-icon>
          <div class="total-details">
            <span class="total-label">TOTAL DE LA VENTE</span>
            <span class="total-amount">{{total | currency:'F':'symbol':'1.0-0'}}</span>
          </div>
        </div>
        <div class="total-actions">
          <button mat-flat-button color="accent" class="print-button" (click)="printPage()">
            <mat-icon>print</mat-icon>
            Imprimer
          </button>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Section supplémentaire pour les détails -->
  <div class="additional-section">
    <div class="details-grid">
      <!-- Commentaires -->
      <mat-card class="detail-card">
        <div class="card-header">
          <h3><mat-icon>comment</mat-icon> Commentaires</h3>
        </div>
        <div class="card-content">
          <p *ngIf="vente.commentaire; else noComment">{{vente.commentaire}}</p>
          <ng-template #noComment>
            <p class="no-data">Aucun commentaire</p>
          </ng-template>
        </div>
      </mat-card>

      <!-- Informations supplémentaires -->
      <mat-card class="detail-card">
        <div class="card-header">
          <h3><mat-icon>info</mat-icon> Informations</h3>
        </div>
        <div class="card-content">
          <div class="info-item">
            <mat-icon class="info-icon">person</mat-icon>
            <div class="info-content">
              <span class="info-label">Client</span>
              <span class="info-value">{{vente.ligneVentes || 'Non spécifié'}}</span>
            </div>
          </div>
          <!-- <div class="info-item">
            <mat-icon class="info-icon">phone</mat-icon>
            <div class="info-content">
              <span class="info-label">Téléphone</span>
              <span class="info-value">{{vente.telephoneClient || 'Non spécifié'}}</span>
            </div>
          </div>
          <div class="info-item">
            <mat-icon class="info-icon">email</mat-icon>
            <div class="info-content">
              <span class="info-label">Email</span>
              <span class="info-value">{{vente.emailClient || 'Non spécifié'}}</span>
            </div>
          </div> -->
        </div>
      </mat-card>
    </div>
  </div>

  <!-- Composant de détails des lignes de commande -->
  <div class="details-section">
    <app-details-lignes-commandes
      [idCommande]="vente?.id"
      [origin]="'ventes'">
    </app-details-lignes-commandes>
  </div>
</div>